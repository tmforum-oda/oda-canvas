---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.17.2
  name: availabilitypolicies.availability.oda.tmforum.org
spec:
  group: availability.oda.tmforum.org
  names:
    categories:
    - oda-canvas
    kind: AvailabilityPolicy
    listKind: AvailabilityPolicyList
    plural: availabilitypolicies
    shortNames:
    - apol
    singular: availabilitypolicy
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .spec.availabilityClass
      name: Availability Class
      type: string
    - jsonPath: .spec.enforcement
      name: Enforcement
      type: string
    - jsonPath: .spec.priority
      name: Priority
      type: integer
    - jsonPath: .status.appliedToComponents[*]
      name: Components
      type: integer
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: AvailabilityPolicy is the Schema for the availabilitypolicies
          API
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: AvailabilityPolicySpec defines the desired state of AvailabilityPolicy
            properties:
              allowOverride:
                default: true
                description: AllowOverride allows annotations to override when true
                  (only for advisory mode)
                type: boolean
              availabilityClass:
                description: AvailabilityClass defines the level of availability required
                enum:
                - non-critical
                - standard
                - high-availability
                - mission-critical
                - custom
                type: string
              componentSelector:
                description: ComponentSelector defines which components this policy
                  applies to
                properties:
                  componentFunctions:
                    description: ComponentFunctions specifies component functions
                      to match
                    items:
                      description: ComponentFunction defines the function of the component
                        within ODA Canvas
                      enum:
                      - core
                      - management
                      - security
                      type: string
                    type: array
                  componentNames:
                    description: ComponentNames specifies explicit component names
                    items:
                      type: string
                    type: array
                  matchExpressions:
                    description: MatchExpressions selects components using label expressions
                    items:
                      description: |-
                        A label selector requirement is a selector that contains values, a key, and an operator that
                        relates the key and values.
                      properties:
                        key:
                          description: key is the label key that the selector applies
                            to.
                          type: string
                        operator:
                          description: |-
                            operator represents a key's relationship to a set of values.
                            Valid operators are In, NotIn, Exists and DoesNotExist.
                          type: string
                        values:
                          description: |-
                            values is an array of string values. If the operator is In or NotIn,
                            the values array must be non-empty. If the operator is Exists or DoesNotExist,
                            the values array must be empty. This array is replaced during a strategic
                            merge patch.
                          items:
                            type: string
                          type: array
                          x-kubernetes-list-type: atomic
                      required:
                      - key
                      - operator
                      type: object
                    type: array
                  matchLabels:
                    additionalProperties:
                      type: string
                    description: MatchLabels selects components with matching labels
                    type: object
                  namespaces:
                    description: Namespaces specifies which namespaces to watch (empty
                      means all)
                    items:
                      type: string
                    type: array
                type: object
              customPDBConfig:
                description: CustomPDBConfig allows custom PDB configuration when
                  AvailabilityClass is "custom"
                properties:
                  maxUnavailable:
                    anyOf:
                    - type: integer
                    - type: string
                    description: MaxUnavailable specifies the maximum number of pods
                      that can be unavailable
                    x-kubernetes-int-or-string: true
                  minAvailable:
                    anyOf:
                    - type: integer
                    - type: string
                    description: MinAvailable specifies the minimum number of pods
                      that must be available
                    x-kubernetes-int-or-string: true
                  unhealthyPodEvictionPolicy:
                    default: IfHealthyBudget
                    description: UnhealthyPodEvictionPolicy defines how to deal with
                      unhealthy pods
                    enum:
                    - IfHealthyBudget
                    - AlwaysAllow
                    type: string
                type: object
              enforceMinReplicas:
                default: true
                description: EnforceMinReplicas ensures deployments have minimum replicas
                  for PDB to be effective
                type: boolean
              enforcement:
                default: advisory
                description: Enforcement defines how strictly this policy is enforced
                enum:
                - strict
                - flexible
                - advisory
                type: string
              maintenanceWindows:
                description: MaintenanceWindows defines when disruptions are allowed
                items:
                  description: MaintenanceWindow defines a time window when disruptions
                    are allowed
                  properties:
                    daysOfWeek:
                      description: Days of week when maintenance window applies (0=Sunday,
                        6=Saturday)
                      items:
                        type: integer
                      type: array
                    end:
                      description: End time in HH:MM format
                      pattern: ^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$
                      type: string
                    start:
                      description: Start time in HH:MM format
                      pattern: ^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$
                      type: string
                    timezone:
                      default: UTC
                      description: Timezone (defaults to UTC)
                      type: string
                  required:
                  - end
                  - start
                  type: object
                type: array
              minimumClass:
                description: MinimumClass defines the minimum availability class allowed
                  when enforcement is flexible
                enum:
                - non-critical
                - standard
                - high-availability
                - mission-critical
                - custom
                type: string
              overrideRequiresAnnotation:
                description: OverrideRequiresAnnotation specifies an annotation that
                  must be present to allow override
                type: string
              overrideRequiresReason:
                default: false
                description: OverrideRequiresReason requires a reason annotation when
                  overriding
                type: boolean
              priority:
                default: 0
                description: Priority defines the priority of this policy (higher
                  number = higher priority)
                format: int32
                type: integer
            required:
            - availabilityClass
            - componentSelector
            type: object
          status:
            description: AvailabilityPolicyStatus defines the observed state of AvailabilityPolicy
            properties:
              appliedToComponents:
                description: AppliedToComponents lists the components this policy
                  is currently applied to
                items:
                  type: string
                type: array
              conditions:
                description: Conditions represent the latest available observations
                  of the policy's current state
                items:
                  description: Condition contains details for one aspect of the current
                    state of this API Resource.
                  properties:
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        message is a human readable message indicating details about the transition.
                        This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                        with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        Producers of specific condition types may define expected values and meanings for this field,
                        and whether the values are considered a guaranteed API.
                        The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
              lastAppliedTime:
                description: LastAppliedTime indicates when this policy was last successfully
                  applied
                format: date-time
                type: string
              observedGeneration:
                description: ObservedGeneration reflects the generation of the most
                  recently observed AvailabilityPolicy
                format: int64
                type: integer
              pdbsManaged:
                description: PDBsManaged lists the PDBs currently managed by this
                  policy
                items:
                  type: string
                type: array
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
